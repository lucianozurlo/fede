<!doctype html>
<html lang="en">

  <head>
    <link rel="stylesheet" href="parallax.css">
  </head>

  <body style="background-color: grey;">
    <div style="height: 60vh;"></div>

    <div id="contact" class="tt-section">

      <div class="bg-vectors">
        <img src="assets/img/footer-4.svg" data-parallax data-speed="0.3" />
      </div>

      <div class="footer-masked footer1" data-parallax data-speed="0.6">
        <div class="footer-ink footer1">
          <img class="footer-probe" src="assets/img/footer-1.svg" alt="" />
          <div class="footer-texture orange" aria-hidden="true"></div>
        </div>
      </div>

      <div class="footer-masked footer1" data-parallax data-speed="0.3">
        <div class="footer-ink footer2">
          <img class="footer-probe" src="assets/img/footer-2.svg" alt="" />
          <div class="footer-texture yellow" aria-hidden="true"></div>
        </div>
      </div>

      <div class="footer-masked footer3" data-parallax data-speed="0.3">
        <div class="footer-ink footer3">
          <img class="footer-probe" src="assets/img/footer-3.svg" alt="" />
          <div class="footer-texture yellow" aria-hidden="true"></div>
        </div>
      </div>

      <div class="footer-bottom-full" aria-hidden="true" data-parallax data-speed="0.3"></div>

      <div class="footer-bottom-mask mask2" aria-hidden="true" data-parallax data-speed="0.3">
        <div class="footer-bottom-cut"></div>
      </div>

      <div class="footer-bottom-mask mask3" aria-hidden="true" data-parallax data-speed="0.3">
        <div class="footer-bottom-cut"></div>
      </div>

    </div>


    <script>
      (() => {
        const section = document.querySelector('#contact');
        if (!section) return;

        const layers = Array.from(section.querySelectorAll('[data-parallax][data-speed]'));
        if (!layers.length) return;

        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)');

        let ticking = false;

        const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

        function update() {
          ticking = false;
          if (prefersReduced.matches) return;

          const rect = section.getBoundingClientRect();
          const vh = window.innerHeight || document.documentElement.clientHeight;

          // progreso de la sección en viewport:
          // 0 cuando recién entra (top = vh), 1 cuando ya pasó (bottom = 0)
          const total = rect.height + vh;
          const progress = clamp((vh - rect.top) / total, 0, 1);

          // "amplitud" en px: ajustá a gusto
          const base = rect.height * 0.35; // 35% del alto de la sección

          layers.forEach(el => {
            const speed = parseFloat(el.dataset.speed || '0.2');

            // centro -> 0, arriba/abajo -> -0.5..0.5
            const centered = (progress - 0.5);

            // desplazamiento final
            const y = centered * base * speed * 2; // el *2 abre el rango

            el.style.transform = `translate3d(0, ${y.toFixed(2)}px, 0)`;
          });
        }

        function onScroll() {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(update);
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', onScroll);

        // primera corrida
        update();

        // si cambia reduce motion
        prefersReduced.addEventListener?.('change', update);
      })();
    </script>

  </body>

</html>
