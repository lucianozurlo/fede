<!doctype html>
<html lang="es">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="view-transition" content="same-origin" />
        <title>P√°gina 1</title>

        <!-- Lee la direcci√≥n ANTES del render (clave para la transici√≥n) -->
        <script>
            (function () {
                const dir = sessionStorage.getItem("vt_dir");
                if (dir) document.documentElement.dataset.vtDir = dir; // "next" | "prev"
            })();
        </script>

        <style>
            :root {
                --vt-dur: 520ms;
                --vt-ease: cubic-bezier(.2, .8, .2, 1);

                /* defaults: swipe izquierda => "next" */
                --vt-old-from: 0%;
                --vt-old-to: -100%;
                --vt-new-from: 100%;
                --vt-new-to: 0%;
            }

            :root[data-vt-dir="prev"] {
                /* swipe derecha => "prev" */
                --vt-old-to: 100%;
                --vt-new-from: -100%;
            }

            /* Fondo del overlay de transici√≥n */
            ::view-transition {
                background: transparent;
            }

            /* Quitamos cross-fade y metemos slide */
            ::view-transition-old(root),
            ::view-transition-new(root) {
                mix-blend-mode: normal;
                animation-duration: var(--vt-dur);
                animation-timing-function: var(--vt-ease);
                animation-fill-mode: both;
            }

            ::view-transition-old(root) {
                animation-name: vt-old-slide;
            }

            ::view-transition-new(root) {
                animation-name: vt-new-slide;
            }

            @keyframes vt-old-slide {
                from {
                    transform: translateX(var(--vt-old-from));
                }

                to {
                    transform: translateX(var(--vt-old-to));
                }
            }

            @keyframes vt-new-slide {
                from {
                    transform: translateX(var(--vt-new-from));
                }

                to {
                    transform: translateX(var(--vt-new-to));
                }
            }

            /* Layout demo */
            html,
            body {
                height: 100%;
            }

            body {
                margin: 0;
                background: #ff6a00;
                color: #fff;
                font: 600 18px/1.2 system-ui, -apple-system, Segoe UI, Roboto;
                display: grid;
                place-items: center;
                touch-action: pan-y;
                /* deja scroll vertical, limita horizontal */
                overscroll-behavior: contain;
                /* reduce gestos laterales del navegador */
            }

            .card {
                width: min(560px, 92vw);
                padding: 18px 16px;
                border-radius: 14px;
                background: rgba(0, 0, 0, .22);
                backdrop-filter: blur(8px);
            }

            .row {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                margin-top: 12px;
            }

            a.btn {
                display: inline-block;
                padding: 10px 12px;
                border-radius: 12px;
                background: rgba(255, 255, 255, .18);
                color: #fff;
                text-decoration: none;
            }

            .hint {
                opacity: .85;
                margin: 8px 0 0;
            }

        </style>
    </head>

    <body>
        <div class="card">
            <div>üì± P√°gina 1 (naranja)</div>
            <div class="hint">Swipe izquierda ‚Üí siguiente | Swipe derecha ‚Üí anterior</div>

            <div class="row">
                <a class="btn" href="page-3.html" data-nav="prev">‚Üê Ir a P√°gina 3</a>
                <a class="btn" href="page-2.html" data-nav="next">Ir a P√°gina 2 ‚Üí</a>
            </div>
        </div>

        <script>
            (function swipeNav() {
                const prevUrl = "page-3.html";
                const nextUrl = "page-2.html";

                const isMobile =
                    matchMedia("(pointer: coarse)").matches ||
                    /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

                // Guardar direcci√≥n en clicks tambi√©n (para ver la animaci√≥n en desktop)
                document.querySelectorAll("a[data-nav]").forEach(a => {
                    a.addEventListener("click", (e) => {
                        const dir = a.getAttribute("data-nav"); // "prev" | "next"
                        sessionStorage.setItem("vt_dir", dir);
                    });
                });

                if (!isMobile) return;

                let startX = 0, startY = 0, startT = 0, tracking = false;

                const minDistance = 70; // px
                const maxVertical = 60; // px
                const maxTime = 650;    // ms

                window.addEventListener("pointerdown", (e) => {
                    if (e.pointerType && e.pointerType !== "touch") return;
                    if (e.isPrimary === false) return;

                    tracking = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startT = performance.now();
                }, { passive: true });

                window.addEventListener("pointerup", (e) => {
                    if (!tracking) return;
                    tracking = false;

                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    const dt = performance.now() - startT;

                    if (dt > maxTime) return;
                    if (Math.abs(dy) > maxVertical) return;
                    if (Math.abs(dx) < minDistance) return;

                    if (dx < 0 && nextUrl) {
                        sessionStorage.setItem("vt_dir", "next");
                        location.assign(nextUrl);
                    } else if (dx > 0 && prevUrl) {
                        sessionStorage.setItem("vt_dir", "prev");
                        location.assign(prevUrl);
                    }
                }, { passive: true });

                window.addEventListener("pointercancel", () => { tracking = false; }, { passive: true });
            })();
        </script>
    </body>

</html>
