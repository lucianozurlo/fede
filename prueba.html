<!doctype html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Document</title>
   </head>
   <body>
      <section
         style="height: 120vh; background: #111; color: #fff; display: grid; place-items: center"
      >
         <h2>Scroll hacia abajo →</h2>
      </section>

      <!-- CONTENEDOR PARALLAX -->
      <div class="parallax-wrap">
         <div class="parallax-item" data-parallax-speed="0.35">
            <img src="assets/img/hero.png" alt="Hero" />
         </div>
      </div>

      <section style="height: 120vh; background: #111"></section>

      <script>
         (() => {
            // Selecciona TODOS los que tengan data-parallax-speed
            const els = Array.from(document.querySelectorAll('[data-parallax-speed]'));
            if (!els.length) return;

            // Si tenés "reduce motion" activado, no corremos el efecto
            if (matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            let ticking = false;

            function compute() {
               const vh2 = window.innerHeight * 0.5;
               for (const el of els) {
                  const speed = parseFloat(el.getAttribute('data-parallax-speed') || '0');
                  if (!speed) continue;

                  // Centro del elemento vs centro de la ventana
                  const rect = el.getBoundingClientRect();
                  const delta = rect.top + rect.height * 0.5 - vh2;

                  // Movimiento proporcional
                  const ty = -delta * speed;

                  // Clamp opcional para evitar excesos
                  const clamp = 240;
                  const v = Math.max(-clamp, Math.min(clamp, ty));

                  // Aplicamos transform directo (sin variables CSS)
                  el.style.transform = `translate3d(0, ${v}px, 0)`;
               }
               ticking = false;
            }

            function onScrollOrResize() {
               if (!ticking) {
                  ticking = true;
                  requestAnimationFrame(compute);
               }
            }

            // Primer cálculo y listeners
            compute();
            window.addEventListener('scroll', onScrollOrResize, { passive: true });
            window.addEventListener('resize', onScrollOrResize);
         })();
      </script>

      <style>
         .parallax-wrap {
            position: relative;
            height: 80vh; /* espacio para ver el efecto */
            display: grid;
            place-items: center;
            overflow: visible;
            background: #f4f4f4;
         }
         .parallax-item {
            will-change: transform;
            transition: transform 0s; /* asegura actualizaciones inmediatas */
            display: inline-block;
         }
         .parallax-item img {
            display: block;
            max-width: min(80vw, 900px);
            height: auto;
         }
      </style>
   </body>
</html>
